image: python:3.11

variables:
  PIP_CACHE_DIR: ".cache/pip"
  PIP_DISABLE_PIP_VERSION_CHECK: "1"

cache:
  key: "python-3.11"
  paths:
    - .cache/pip

before_script:
  - python --version
  - pip install --upgrade pip
  - pip install -r vscode_snowflake_starter/requirements.txt

stages:
  - exec

exec_stage:
  stage: exec
  script:
    - echo "=== EXEC STAGE STARTING ==="
    - python vscode_snowflake_starter/src/exec_audit_summary.py
    - echo "EXEC_READY=true" > exec.env
    - echo "=== FILES CREATED ==="
    - find . -name "*.md" -o -name "*.csv" | head -10
  artifacts:
    when: always
    expire_in: 7 days
    paths:
      - "**/*.md"
      - "**/*.csv"
      - exec.env
    reports:
      dotenv: exec.env
  rules:
    - when: manual
