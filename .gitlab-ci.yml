# GitLab CI configuration for Zen Market AI
# Runs daily forecast, ingests data, emails results

stages:
  - forecast
  - notify

forecast_job:
  stage: forecast
  image: python:3.11-slim
  script:
    - pip install -r requirements.txt

    # Permanent discovery logs for visibility
    - echo "📂 Contents of src/:"
    - ls -l src/ || echo "⚠️ src/ folder missing"
    - echo "📂 All Python files in repository:"
    - find . -type f -name "*.py" -print

    # Always run the known good forecast script
    - python src/forecast.py > forecast_output.txt
  artifacts:
    paths:
      - forecast_output.txt

send_email_job:
  stage: notify
  image: python:3.11-slim
  dependencies:
    - forecast_job
  script:
    - pip install -r requirements.txt
    - python src/send_email.py
  only:
    - main


