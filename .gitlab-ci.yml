image: python:3.11-slim

cache:
  key: pip-cache
  paths:
    - .cache/pip

before_script:
  - python --version
  - pip install --upgrade pip
  - pip install --cache-dir=.cache/pip pandas snowflake-connector-python yfinance

stages:
  - ingest
  - snapshot
  - forecast
  - maintenance

ingest:
  stage: ingest
  script:
    - python src/Spy_BackFill.py
    - python src/ES_BackFill.py

snapshot:
  stage: snapshot
  script:
    - python src/stage3_snapshot.py

forecast:
  stage: forecast
  script:
    - python src/stage4_forecast.py

# ðŸ§¹ Weekly job to refresh pip cache
refresh-cache:
  stage: maintenance
  script:
    - rm -rf .cache/pip
  only:
    - schedules   # this runs only if scheduled in GitLab CI/CD > Schedules
