# üìå Title
# Zen Council ‚Äì CI Jobs for Stage 3.x (Forecast, Scoring, Email)
#
# üìù Commit Notes
# Commit Title: CI: add Stage 3.x jobs (forecast, scoring, email) chained after Stage 2.3
# Commit Message:
# - Adds stage3_forecast_job ‚Üí runs ingest_forecast_job.py
# - Adds stage3_score_job ‚Üí runs score_forecast_job.py
# - Adds stage3_email_job ‚Üí runs send_forecast_email.py
# - Uses `needs:` chaining to enforce order: forecast ‚Üí score ‚Üí email.

stage3_forecast_job:
  stage: metrics
  needs: ["stage2_vix_term_structure"]
  script:
    - python src/ingest_forecast_job.py
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
    - if: '$CI_COMMIT_BRANCH == "main"'

stage3_score_job:
  stage: metrics
  needs: ["stage3_forecast_job"]
  script:
    - python src/score_forecast_job.py
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
    - if: '$CI_COMMIT_BRANCH == "main"'

stage3_email_job:
  stage: metrics
  needs: ["stage3_score_job"]
  script:
    - python src/send_forecast_email.py
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
    - if: '$CI_COMMIT_BRANCH == "main"'
