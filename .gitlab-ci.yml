# GitLab CI configuration for Zen Market AI
# Runs daily forecast, ingests data, emails results

stages:
  - forecast
  - email

default:
  image: python:3.11-slim
  before_script:
    - pip install -r requirements.txt

forecast_job:
  stage: forecast
  script:
    - python src/stage4_forecast.py
  artifacts:
    paths:
      - out/forecast.json
    expire_in: 1 day

email_job:
  stage: email
  needs: ["forecast_job"]
  script:
    - python src/send_email.py
  only:
    - main

workflow:
  rules:
    - if: '$CI_PIPELINE_SOURCE == "push"'
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
