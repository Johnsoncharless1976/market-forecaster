# üìÑ File: .gitlab-ci.yml
#
# üìå Title
# Zen Council ‚Äì Master CI/CD Pipeline (Skeletonized: Stage 5 Active)
#
# üìù Commit Notes
# Commit Title: CI: skeletonized pipeline with Stage 5 active, others commented
# Commit Message:
# - All stages retained in file for consistency and visibility.
# - Only Stage 5 formatting/distribution job enabled.
# - Other jobs commented out to reduce runtime while validating Stage 5.

stages:
  - ingest
  - metrics
  - forecast
  - audit
  - formatting
  - build
  - test
  - deploy

default:
  image: python:3.11-slim
  before_script:
    - python -V
    - pip install -r requirements.txt

# --------------------------
# ‚úÖ ACTIVE JOB (Stage 5 Formatting & Distribution)
# --------------------------

stage5_formatting:
  stage: formatting
  script:
    - python src/format_and_send_forecast.py
  rules:
    - if: '$CI_PIPELINE_SOURCE == "push"'
    - if: '$CI_COMMIT_BRANCH == "main"'

# --------------------------
# ‚ùå INACTIVE JOBS (commented out for now, retained for later)
# --------------------------

# Stage 1: Daily Market Data Ingestion
# daily_ingestion:
#   stage: ingest
#   script:
#     - python src/data_ingestion.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'

# Stage 2.1: Derived Metrics
# stage2_derived_metrics:
#   stage: metrics
#   needs: ["daily_ingestion"]
#   script:
#     - python src/ingest_derived_metrics.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'

# Stage 2.2: Rolling Correlations
# stage2_rolling_correlations:
#   stage: metrics
#   needs: ["stage2_derived_metrics"]
#   script:
#     - python src/ingest_correlations.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'

# Stage 2.3: VIX Term Structure
# stage2_vix_term_structure:
#   stage: metrics
#   needs: ["stage2_rolling_correlations"]
#   script:
#     - python src/ingest_vix_term_structure.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'

# Stage 3: Forecast Jobs
# stage3_forecast_jobs:
#   stage: forecast
#   needs: ["stage2_vix_term_structure"]
#   script:
#     - python src/ingest_forecast_jobs.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'

# Stage 4: Audit Loop
# stage4_audit_loop:
#   stage: audit
#   needs: ["stage3_forecast_jobs"]
#   script:
#     - python src/ingest_audit_loop.py
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "schedule"'
#     - if: '$CI_COMMIT_BRANCH == "main"'
