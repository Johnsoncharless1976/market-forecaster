audit_cli:
  stage: reports
  script:
    - python vscode_snowflake_starter/src/exec_audit_summary.py
    - echo "EXEC_READY=true" > exec.env
  artifacts:
    when: always
    paths:
      - vscode_snowflake_starter/audit_exports/stage1_exec_*/REPORT_EXEC.md
      - vscode_snowflake_starter/audit_exports/stage1_exec_*/summary.csv
    expire_in: 7 days
  dependencies: []
  rules:
    - if: '$CI_PIPELINE_SOURCE == "web"'
  when: manual
  after_script:
    - echo "===== SUMMARY ====="
    - ls -la vscode_snowflake_starter/audit_exports/stage1_exec_* || true
    - sed -n '1,200p' vscode_snowflake_starter/audit_exports/stage1_exec_*/REPORT_EXEC.md || true
