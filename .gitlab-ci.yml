# # 📄 File: .gitlab-ci.yml  (append this job near the others)
#
# 📌 Title
# Zen Council – CI Job for Stage 2.3 VIX Term Structure (post‑Stage 2.2)
#
# 📝 Commit Notes
# Commit Title: CI: add Stage 2.3 VIX term structure job after correlations
# Commit Message:
# - Runs src/ingest_vix_term_structure.py after Stage 2.2.
# - No external HTTP; expects staged CSV at @FORECASTING_STAGE/vix_term_structure.csv.gz.
# - Safe to run even if file absent → clear skip message; pipeline flows.

stage2_vix_term_structure:
  stage: metrics
  image: python:3.11-slim
  needs: ["stage2_rolling_correlations"]
  script:
    - pip install -r requirements.txt
    - 'test -f src/ingest_vix_term_structure.py || { echo "❌ src/ingest_vix_term_structure.py not found"; exit 1; }'
    - python src/ingest_vix_term_structure.py
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
    - if: '$CI_COMMIT_BRANCH == "main"'
