# .gitlab-ci.yml
# Full pipeline: Stage 1 → Ingest, Stage 2 → Verify, Stage 3 → Snapshot, Stage 4 → Forecast

stages:
  - ingest
  - verify
  - analyze

# -------------------
# Stage 1 – Ingest Jobs
# -------------------
spy_to_snowflake:
  stage: ingest
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python
    - python src/spy_to_snowflake.py

es_to_snowflake:
  stage: ingest
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python yfinance
    - python src/es_to_snowflake.py

vix_vvix_to_snowflake:
  stage: ingest
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python
    - python src/vix_vvix_to_snowflake.py

# -------------------
# Stage 2 – Verify
# -------------------
verify_ingestion:
  stage: verify
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python
    - python src/verify_ingestion.py
  needs: ["spy_to_snowflake", "es_to_snowflake", "vix_vvix_to_snowflake"]

# -------------------
# Stage 3 – Snapshot
# -------------------
stage3_snapshot:
  stage: analyze
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python yfinance
    - python src/stage3_snapshot.py
  needs: ["verify_ingestion"]

# -------------------
# Stage 4 – Forecast
# -------------------
stage4_forecast:
  stage: analyze
  image: python:3.11-slim
  script:
    - pip install --upgrade pip
    - pip install pandas snowflake-connector-python yfinance
    - python src/stage4_forecast.py
  needs: ["stage3_snapshot"]
