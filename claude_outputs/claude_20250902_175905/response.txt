Here is the code to generate the AM Kneeboard and post it to Slack and Notion:

# File: am_kneeboard.py
# Title: AM Kneeboard Generator
# Commit Notes: Generates AM kneeboard with forecast summary and ATM straddle band, posts to Slack and Notion.

import os
import pandas as pd
import numpy as np
from sqlalchemy import create_engine
import requests
from datetime import datetime, timedelta

# Snowflake connection
engine = create_engine('snowflake://user:password@account.region/database/schema')

# Fetch data
df = pd.read_sql_query("""
    SELECT * 
    FROM market_data
    WHERE date = CURRENT_DATE - 1
""", engine)

# Calculate forecast summary
forecast_mean = df['close'].mean()
forecast_std = df['close'].std()
forecast_range = (forecast_mean - 2 * forecast_std, forecast_mean + 2 * forecast_std)

# Calculate ATM straddle band
atm_price = df['close'].iloc[-1]
atm_straddle = 2 * df['close'].std()
atm_straddle_band = (atm_price - atm_straddle, atm_price + atm_straddle)

# Prepare kneeboard
kneeboard = f"""
AM Kneeboard
Forecast Summary:
- Mean: {forecast_mean:.2f}
- Range: {forecast_range[0]:.2f} - {forecast_range[1]:.2f}

ATM Straddle Band:
- ATM Price: {atm_price:.2f}
- Straddle: {atm_straddle:.2f}
- Band: {atm_straddle_band[0]:.2f} - {atm_straddle_band[1]:.2f}
"""

# Post to Slack
slack_webhook = os.environ['SLACK_WEBHOOK']
requests.post(slack_webhook, json={'text': kneeboard})

# Post to Notion
notion_token = os.environ['NOTION_TOKEN']
notion_page_id = os.environ['NOTION_PAGE_ID']
notion_headers = {
    'Authorization': f'Bearer {notion_token}',
    'Content-Type': 'application/json',
    'Notion-Version': '2022-06-28'
}
notion_data = {
    'parent': {'database_id': notion_page_id},
    'properties': {
        'Date': {'date': {'start': (datetime.now() - timedelta(days=1)).strftime('%Y-%m-%d')}},
        'Kneeboard': {'rich_text': [{'text': {'content': kneeboard}}]}
    }
}
requests.post('https://api.notion.com/v1/pages', headers=notion_headers, json=notion_data)

print('AM Kneeboard generated and posted to Slack and Notion.')
```

To run this script, you'll need to:

1. Install the required Python packages: `pandas`, `numpy`, `sqlalchemy`, `requests`.
2. Set the following environment variables:
   - `SLACK_WEBHOOK`: Your Slack webhook URL for posting the kneeboard.
   - `NOTION_TOKEN`: Your Notion API token.
   - `NOTION_PAGE_ID`: The Notion database page ID where you want to post the kneeboard.
3. Save the script as `am_kneeboard.py` in your repository.
4. Run the script using Python: `python am_kneeboard.py`

The script will generate the AM kneeboard, post it to Slack, and create a new page in the specified Notion database. The script is idempotent, so it can be run multiple times without creating duplicate entries.
